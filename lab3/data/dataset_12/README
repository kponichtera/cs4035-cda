########################################################
Malware Capture Facility
CVUT University, Prague, Czech Republic

These files were generated as part of a research project in the CVUT University, Prague, Czech Republic.
The goal is to store long-lived real botnet traffic and to generate labeled netflows files.
Any question feel free to contact us:
Sebastian Garcia: sebastian.garcia@agents.fel.cvut.cz

Disclaimer: You are free to use these files as long as you reference this project and the authors.
########################################################


Pcap files:
- capture20110819.pcap
It is a capture with all the traffic (background, normal and botnet)
This pcap file is not made public because it contains too much private information about the users of the network.

- botnet-capture-20110819-bot.pcap
Capture with only the botnet traffic. It is made public.

Netflow files:
- capture20110819.pcap.netflow.labeled
This file has the netflows generated by a unidirectional argus. The labels were assigned as this:
1- First put Background to all the flows.
2- Put LEGITIMATE to the flows that match some filters.
3- Put Botnet to the flows that come to or from the IP address 147.32.84.165

The filters for normal (or legitimate) traffic had the IP address of our co-workers in the lab that we are sure were not infected because we check their computers by hand.


Generic info
------------
Binary used: 3d3d%3F%3F%3F%3F.xls.exe
Md5: eaf85db9898d3c9101fd5fcfa4ac80e4
Probable Name: ?

Infected Machines:
Windows XP Name: SARUMAN, IP: 147.32.84.165 (Label: Botnet)
Windows XP Name: SARUMAN1, IP: 147.32.84.191 (Label: Botnet)
Windows XP Name: SARUMAN2, IP: 147.32.84.192 (Label: Botnet)


Timeline
========
vie ago 19 10:32:08 CEST 2011
We started the overall capture.

Bandwith is 100kbps and burst is 1000kb

vie ago 19 10:41:22 CEST 2011
We started the bot capture.
This malware use to scan UDP ports.


vie ago 19 10:41:59 CEST 2011
We started the vm saruman.

vie ago 19 10:42:39 CEST 2011
We infected the vm.

vie ago 19 10:46:39 CEST 2011
We started saruman1 vm

vie ago 19 10:47:18 CEST 2011
We infected saruman1 vm

vie ago 19 10:49:09 CEST 2011
We started saruman2 vm

vie ago 19 10:50:25 CEST 2011
We infected saruman2 vm.

vie ago 19 10:53:11 CEST 2011
We changed the bandwith limit to 5000kbps and burst 1000kb
But we are not sure it worked. We see no change in the amount of flows. Perhaps we should wait some minutes.

vie ago 19 11:44:17 CEST 2011
We stopped the vms.

vie ago 19 11:45:29 CEST 2011
We stopped both captures.



Traffic Analysis
----------------
The bot uses P2P protocol.

There is an interesting use of P2P, for example:
2011-08-19 10:44:25.688258 IP 58.153.244.139.7600 > 147.32.84.165.7600: UDP, length 1056
E..<....n.Q/:.... T......(....E.x..YjG|.U..Q.7.2.>..Z........................./html/client/resource_new//p6.gifPK...........r.?..^M.8'...B..%.................../html/client/resource_new//reom.jpgPK...........r.?]..YY...Y...#.............'9..../html/client/resource_new//p
8.gifPK...........r.?]...........(..............9..../html/client/resource_new//gametop.gifPK...........n-=K..........................;..../html/client/resource_new//newmovie-game.gifPK..........6.4=C..ai...V...,..............=..../html/client/resource_new//soft-100920.j
pgPK............5=.........7..'.............~B..../html/client/resource_new//reom-1.jpgPK...........r.?........#...(..............`..../html/client/resource_new//newgame.gifPK...........r.?............)..............b..../html/client/resource_new//newmovie.gifPK.........
..r.?....W...W...#..............e..../html/client/resource_new//p5.gifPK...........r.??.......^...3..............e..../html/client/resource_new//client_YuanZhengol.jpgPK...........r.?3.(:Y^M......3.................../html/client/resource_new//client_WeiBiaoTi-2.jpgPK....
